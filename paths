#!/bin/bash

# Version of the script
SCRIPT_VERSION="1.0.5"

# Display the script's own location
echo "Script location: $(dirname $(readlink -f $0))"

# Shows active paths line by line
echo "Active paths are:"
echo $PATH | tr ':' '\n'

# Function to check for updates
check_for_update() {
    echo "Checking for updates..."
    echo "Attempting to fetch the script from: $VERSION_URL"
    
    # Download the raw script content from GitHub
    SCRIPT_CONTENT=$(curl -s $VERSION_URL)

    # Check if the download failed (e.g., 404 Not Found)
    if [[ "$SCRIPT_CONTENT" == *"404: Not Found"* ]]; then
        echo "Error: Unable to find the script on GitHub. Please check the URL manually:"
        echo "$VERSION_URL"
        return
    fi
    
    # Extract the version number from the downloaded script content
    LATEST_VERSION=$(echo "$SCRIPT_CONTENT" | grep -oP '(?<=SCRIPT_VERSION=")[0-9]+\.[0-9]+\.[0-9]+')

    # Ensure the extracted version is displayed correctly
    echo "Extracted version from GitHub: $LATEST_VERSION"

    # Compare the extracted version with the current version
    if [ "$LATEST_VERSION" != "" ] && [ "$LATEST_VERSION" != "$SCRIPT_VERSION" ]; then
        echo "A new version ($LATEST_VERSION) is available. Current version: $SCRIPT_VERSION"
        echo "Update the script by downloading it from: https://github.com/$GITHUB_USER/$GITHUB_REPO"
    else
        echo "You are using the latest version ($SCRIPT_VERSION)."
    fi
}

# GitHub repository and raw file URL
GITHUB_USER="kappuchino"
GITHUB_REPO="trivial-tools"
GITHUB_FILE="paths"
VERSION_URL="https://raw.githubusercontent.com/$GITHUB_USER/$GITHUB_REPO/main/$GITHUB_FILE"

# Check for updates
check_for_update
